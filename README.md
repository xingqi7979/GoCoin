# MetaNodeSwap - å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€

MetaNodeSwap æ˜¯ä¸€ä¸ªåŸºäºä»¥å¤ªåŠçš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆDEXï¼‰ï¼Œé‡‡ç”¨é›†ä¸­æµåŠ¨æ€§æ¨¡å‹ï¼Œç±»ä¼¼äº Uniswap V3ã€‚æ¯ä¸ªäº¤æ˜“æ± éƒ½æœ‰å›ºå®šçš„ä»·æ ¼èŒƒå›´ï¼Œæ‰€æœ‰äº¤æ˜“åªèƒ½åœ¨æ­¤ä»·æ ¼èŒƒå›´å†…è¿›è¡Œã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### åˆçº¦ç»“æ„
ç³»ç»ŸæŒ‰ç…§è‡ªé¡¶å‘ä¸‹çš„æ–¹å¼è®¾è®¡ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒåˆçº¦ï¼š

```
MetaNodeSwap ç³»ç»Ÿæ¶æ„
â”œâ”€â”€ é¡¶å±‚åˆçº¦ï¼ˆé¢å‘ç”¨æˆ·ï¼‰
â”‚   â”œâ”€â”€ PoolManager.sol     - æ± ç®¡ç†åˆçº¦ï¼Œå¯¹åº” Pool é¡µé¢
â”‚   â”œâ”€â”€ PositionManager.sol - å¤´å¯¸ç®¡ç†åˆçº¦ï¼Œå¯¹åº” Position é¡µé¢  
â”‚   â””â”€â”€ SwapRouter.sol      - äº¤æ˜“è·¯ç”±åˆçº¦ï¼Œå¯¹åº” Swap é¡µé¢
â”œâ”€â”€ åº•å±‚åˆçº¦ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
â”‚   â”œâ”€â”€ Factory.sol         - æ± å·¥å‚åˆçº¦
â”‚   â””â”€â”€ Pool.sol           - å•ä¸ªäº¤æ˜“æ± åˆçº¦
â””â”€â”€ å·¥å…·åº“
    â”œâ”€â”€ Math.sol           - æ•°å­¦è®¡ç®—åº“
    â””â”€â”€ TickMath.sol       - Tickä»·æ ¼è½¬æ¢åº“
```

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

### ğŸŠâ€â™‚ï¸ æµåŠ¨æ€§ç®¡ç†
- âœ… **æ± åˆ›å»º**ï¼šä»»ä½•äººéƒ½å¯ä»¥åˆ›å»ºäº¤æ˜“æ± ï¼ŒæŒ‡å®šä»·æ ¼èŒƒå›´å’Œæ‰‹ç»­è´¹
- âœ… **æµåŠ¨æ€§æ·»åŠ **ï¼šæµåŠ¨æ€§æä¾›è€…å¯ä»¥åœ¨æŒ‡å®šä»·æ ¼èŒƒå›´å†…æ·»åŠ æµåŠ¨æ€§
- âœ… **æµåŠ¨æ€§ç§»é™¤**ï¼šå¯ä»¥éƒ¨åˆ†æˆ–å®Œå…¨ç§»é™¤ä¹‹å‰æ·»åŠ çš„æµåŠ¨æ€§
- âœ… **æ‰‹ç»­è´¹æ”¶å–**ï¼šæŒ‰æµåŠ¨æ€§è´¡çŒ®æ¯”ä¾‹è‡ªåŠ¨åˆ†é…äº¤æ˜“æ‰‹ç»­è´¹

### ğŸ’± äº¤æ˜“åŠŸèƒ½
- âœ… **ç²¾ç¡®è¾“å…¥äº¤æ˜“**ï¼šæŒ‡å®šè¾“å…¥ä»£å¸æ•°é‡ï¼Œæœ€å¤§åŒ–è¾“å‡º
- âœ… **ç²¾ç¡®è¾“å‡ºäº¤æ˜“**ï¼šæŒ‡å®šè¾“å‡ºä»£å¸æ•°é‡ï¼Œæœ€å°åŒ–è¾“å…¥
- âœ… **å¤šæ± è·¯å¾„**ï¼šæ”¯æŒé€šè¿‡å¤šä¸ªæ± å­è¿›è¡Œå¤æ‚äº¤æ˜“
- âœ… **æ»‘ç‚¹ä¿æŠ¤**ï¼šè®¾ç½®æœ€å°è¾“å‡º/æœ€å¤§è¾“å…¥ä¿æŠ¤

### ğŸ¯ NFT å¤´å¯¸
- âœ… **ERC721 æ ‡å‡†**ï¼šæ¯ä¸ªæµåŠ¨æ€§å¤´å¯¸éƒ½æ˜¯ä¸€ä¸ª NFT
- âœ… **å¤´å¯¸ç®¡ç†**ï¼šæŸ¥çœ‹ã€è½¬ç§»ã€é”€æ¯æµåŠ¨æ€§å¤´å¯¸
- âœ… **æ‰‹ç»­è´¹æ”¶å–**ï¼šé€šè¿‡ NFT ç®¡ç†æ”¶å–çš„æ‰‹ç»­è´¹

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **æ™ºèƒ½åˆçº¦**ï¼šSolidity ^0.8.19
- **å¼€å‘æ¡†æ¶**ï¼šHardhat
- **æ ‡å‡†åº“**ï¼šOpenZeppelin Contracts
- **æµ‹è¯•æ¡†æ¶**ï¼šMocha + Chai
- **ä»£ç è§„èŒƒ**ï¼šå®Œæ•´çš„ä¸­æ–‡æ³¨é‡Š

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js >= 16.0.0
- npm >= 8.0.0

### å®‰è£…ä¾èµ–
```bash
npm install
```

### ç¼–è¯‘åˆçº¦
```bash
npm run compile
```

### è¿è¡Œæµ‹è¯•
```bash
npm run test
```

### æœ¬åœ°éƒ¨ç½²
```bash
# å¯åŠ¨æœ¬åœ°èŠ‚ç‚¹
npm run node

# åœ¨æ–°ç»ˆç«¯ä¸­éƒ¨ç½²åˆ°æœ¬åœ°ç½‘ç»œ
npm run deploy:localhost
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
MetaNodeCoin/
â”œâ”€â”€ contracts/                 # æ™ºèƒ½åˆçº¦æºç 
â”‚   â”œâ”€â”€ interfaces/            # åˆçº¦æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ IFactory.sol      # å·¥å‚åˆçº¦æ¥å£
â”‚   â”‚   â”œâ”€â”€ IPool.sol         # æ± åˆçº¦æ¥å£
â”‚   â”‚   â””â”€â”€ ICallback.sol     # å›è°ƒæ¥å£
â”‚   â”œâ”€â”€ libraries/            # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ Math.sol          # æ•°å­¦è®¡ç®—åº“
â”‚   â”‚   â””â”€â”€ TickMath.sol      # Tickä»·æ ¼è½¬æ¢
â”‚   â”œâ”€â”€ Factory.sol           # æ± å·¥å‚åˆçº¦
â”‚   â”œâ”€â”€ Pool.sol              # å•ä¸ªäº¤æ˜“æ± 
â”‚   â”œâ”€â”€ PoolManager.sol       # æ± ç®¡ç†åˆçº¦
â”‚   â”œâ”€â”€ PositionManager.sol   # å¤´å¯¸ç®¡ç†åˆçº¦
â”‚   â”œâ”€â”€ SwapRouter.sol        # äº¤æ˜“è·¯ç”±åˆçº¦
â”‚   â””â”€â”€ TestToken.sol         # æµ‹è¯•ä»£å¸åˆçº¦
â”œâ”€â”€ scripts/                  # éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ deploy.js            # ä¸»éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ test/                     # æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ MetaNodeSwap.test.js # ä¸»æµ‹è¯•å¥—ä»¶
â”œâ”€â”€ hardhat.config.js        # Hardhaté…ç½®
â””â”€â”€ package.json             # é¡¹ç›®é…ç½®
```

## ğŸ”§ ä½¿ç”¨æŒ‡å—

### 1. åˆ›å»ºäº¤æ˜“æ± 

```javascript
// é€šè¿‡ PoolManager åˆ›å»ºæ–°æ± 
const createParams = {
  token0: tokenA.address,     // ç¬¬ä¸€ä¸ªä»£å¸åœ°å€
  token1: tokenB.address,     // ç¬¬äºŒä¸ªä»£å¸åœ°å€
  fee: 3000,                  // 0.3% æ‰‹ç»­è´¹
  tickLower: -887220,         // ä»·æ ¼åŒºé—´ä¸‹é™
  tickUpper: 887220,          // ä»·æ ¼åŒºé—´ä¸Šé™
  sqrtPriceX96: "79228162514264337593543950336"  // åˆå§‹ä»·æ ¼ 1:1
};

await poolManager.createAndInitializePoolIfNecessary(createParams);
```

### 2. æ·»åŠ æµåŠ¨æ€§

```javascript
// é€šè¿‡ PositionManager æ·»åŠ æµåŠ¨æ€§
const mintParams = {
  token0: tokenA.address,
  token1: tokenB.address,
  index: 0,                   // æ± å­ç´¢å¼•
  amount0Desired: ethers.utils.parseEther("100"),
  amount1Desired: ethers.utils.parseEther("100"),
  recipient: userAddress,
  deadline: Math.floor(Date.now() / 1000) + 3600
};

await positionManager.mint(mintParams);
```

### 3. æ‰§è¡Œäº¤æ˜“

```javascript
// é€šè¿‡ SwapRouter è¿›è¡Œä»£å¸äº¤æ¢
const exactInputParams = {
  tokenIn: tokenA.address,
  tokenOut: tokenB.address,
  indexPath: [0],             // ä½¿ç”¨çš„æ± å­ç´¢å¼•è·¯å¾„
  recipient: userAddress,
  deadline: Math.floor(Date.now() / 1000) + 3600,
  amountIn: ethers.utils.parseEther("10"),
  amountOutMinimum: 0,
  sqrtPriceLimitX96: "4295128740"
};

await swapRouter.exactInput(exactInputParams);
```

## ğŸ“Š æ ¸å¿ƒæ¦‚å¿µ

### Tick å’Œä»·æ ¼
- **Tick**ï¼šä»·æ ¼çš„å¯¹æ•°è¡¨ç¤ºï¼Œç”¨äºé«˜æ•ˆè®¡ç®—
- **sqrtPriceX96**ï¼šä»·æ ¼å¹³æ–¹æ ¹çš„å›ºå®šç‚¹è¡¨ç¤ºï¼ˆQ64.96 æ ¼å¼ï¼‰
- **ä»·æ ¼èŒƒå›´**ï¼šæ¯ä¸ªæ± å­éƒ½æœ‰å›ºå®šçš„ [tickLower, tickUpper] èŒƒå›´

### æµåŠ¨æ€§è®¡ç®—
- **é›†ä¸­æµåŠ¨æ€§**ï¼šæµåŠ¨æ€§é›†ä¸­åœ¨æŒ‡å®šä»·æ ¼èŒƒå›´å†…
- **æ‰‹ç»­è´¹åˆ†é…**ï¼šæŒ‰æµåŠ¨æ€§è´¡çŒ®æ¯”ä¾‹åˆ†é…äº¤æ˜“æ‰‹ç»­è´¹
- **æ— å¸¸æŸå¤±**ï¼šä»·æ ¼æ³¢åŠ¨å¯èƒ½å¯¼è‡´çš„èµ„äº§ä»·å€¼å˜åŒ–

### äº¤æ˜“æœºåˆ¶
- **æ’å®šä¹˜ç§¯**ï¼šåœ¨ä»·æ ¼èŒƒå›´å†…ç»´æŒ x * y = k å…¬å¼
- **æ»‘ç‚¹æ§åˆ¶**ï¼šé€šè¿‡æœ€å°è¾“å‡º/æœ€å¤§è¾“å…¥å‚æ•°æ§åˆ¶
- **å¤šæ± è·¯ç”±**ï¼šæ”¯æŒè·¨å¤šä¸ªæ± å­çš„å¤æ‚äº¤æ˜“è·¯å¾„

## ğŸ§ª æµ‹è¯•è¦†ç›–

é¡¹ç›®åŒ…å«å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼Œè¦†ç›–ä»¥ä¸‹åŠŸèƒ½ï¼š

- âœ… **æ± åˆ›å»ºæµ‹è¯•**ï¼šéªŒè¯æ± çš„åˆ›å»ºå’Œåˆå§‹åŒ–
- âœ… **æµåŠ¨æ€§ç®¡ç†æµ‹è¯•**ï¼šéªŒè¯æµåŠ¨æ€§çš„æ·»åŠ ã€ç§»é™¤å’ŒæŸ¥è¯¢
- âœ… **äº¤æ˜“åŠŸèƒ½æµ‹è¯•**ï¼šéªŒè¯ç²¾ç¡®è¾“å…¥/è¾“å‡ºäº¤æ˜“
- âœ… **NFT å¤´å¯¸æµ‹è¯•**ï¼šéªŒè¯å¤´å¯¸ NFT çš„é“¸é€ å’Œç®¡ç†
- âœ… **å¼‚å¸¸å¤„ç†æµ‹è¯•**ï¼šéªŒè¯å„ç§è¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯å¤„ç†

è¿è¡Œæµ‹è¯•æŸ¥çœ‹è¯¦ç»†ç»“æœï¼š
```bash
npm run test
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

### å·²å®ç°çš„å®‰å…¨æªæ–½
- âœ… **é‡å…¥æ”»å‡»ä¿æŠ¤**ï¼šä½¿ç”¨ lock ä¿®é¥°å™¨é˜²æ­¢é‡å…¥
- âœ… **æ•´æ•°æº¢å‡ºä¿æŠ¤**ï¼šä½¿ç”¨ Solidity ^0.8.19 å†…ç½®æ£€æŸ¥
- âœ… **æˆæƒæ£€æŸ¥**ï¼šä¸¥æ ¼çš„æƒé™æ§åˆ¶å’Œæ‰€æœ‰æƒéªŒè¯
- âœ… **æ»‘ç‚¹ä¿æŠ¤**ï¼šæ”¯æŒæœ€å°è¾“å‡º/æœ€å¤§è¾“å…¥é™åˆ¶
- âœ… **æ—¶é—´é”ä¿æŠ¤**ï¼šæ”¯æŒäº¤æ˜“æˆªæ­¢æ—¶é—´è®¾ç½®

### æ³¨æ„äº‹é¡¹
âš ï¸ **æµ‹è¯•ç¯å¢ƒ**ï¼šå½“å‰ç‰ˆæœ¬ä»…ç”¨äºæµ‹è¯•å’Œå­¦ä¹ ç›®çš„
âš ï¸ **å®¡è®¡éœ€æ±‚**ï¼šç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰éœ€è¦è¿›è¡Œä¸“ä¸šå®‰å…¨å®¡è®¡
âš ï¸ **ä»·æ ¼é£é™©**ï¼šé›†ä¸­æµåŠ¨æ€§å¯èƒ½å¢åŠ æ— å¸¸æŸå¤±é£é™©

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤é—®é¢˜æŠ¥å‘Šå’ŒåŠŸèƒ½è¯·æ±‚ï¼

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼š`git checkout -b feature-name`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature-name`
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ™ è‡´è°¢

- [Uniswap V3](https://github.com/Uniswap/v3-core) - è®¾è®¡çµæ„Ÿæ¥æº
- [OpenZeppelin](https://openzeppelin.com/) - å®‰å…¨çš„åˆçº¦æ ‡å‡†åº“
- [Hardhat](https://hardhat.org/) - å‡ºè‰²çš„å¼€å‘å·¥å…·é“¾

---

**å…è´£å£°æ˜**ï¼šæ­¤é¡¹ç›®ä»…ç”¨äºæ•™è‚²å’Œç ”ç©¶ç›®çš„ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰ï¼Œè¯·ç¡®ä¿è¿›è¡Œå……åˆ†çš„æµ‹è¯•å’Œå®‰å…¨å®¡è®¡ã€‚

## æœ¬åœ°æµ‹è¯•
MetaNodeSwap DEXç³»ç»Ÿç°åœ¨å¯ä»¥åœ¨æœ¬åœ°ç¯å¢ƒä¸­å®Œå…¨æ­£å¸¸è¿è¡Œï¼š
  1. å¯åŠ¨æœ¬åœ°ç½‘ç»œï¼šnpx hardhat node
  2. éƒ¨ç½²åˆçº¦ï¼šnpx hardhat run scripts/deploy.js --network localhost
  3. äº¤äº’æµ‹è¯•ï¼šnpx hardhat run scripts/interact.js --network localhost
  4. è¿è¡Œæµ‹è¯•ï¼šnpm test

  æ‰€æœ‰åŠŸèƒ½éƒ½å·²é€šè¿‡éªŒè¯ï¼Œç³»ç»Ÿå…·å¤‡å®Œæ•´çš„DEXåŠŸèƒ½ï¼ŒåŒ…æ‹¬æµåŠ¨æ€§ç®¡ç†ã€ä»£å¸äº¤æ¢ã€NFTå¤´å¯¸ç®¡ç†ç­‰ã€‚ç”¨æˆ·ç°åœ¨å¯ä»¥åŸºäºè¿™ä¸ªç³»ç»Ÿè¿›è¡Œ
  è¿›ä¸€æ­¥çš„å¼€å‘å’Œæµ‹è¯•ã€‚